import React, { useState, useEffect, useRef } from 'react';
import { initializeApp } from "firebase/app";
import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "firebase/auth";
import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, arrayUnion, increment } from "firebase/firestore";
import { User, BookOpen, Tv, Smartphone, Share2, Play, CheckCircle, Clock } from 'lucide-react';

// --- Firebase Initialization ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

// --- Helper Functions ---
const generateRoomCode = () => {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // No I, O, 0, 1 to avoid confusion
    let result = '';
    for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
    return result;
};

// --- Components ---

function App() {
    const [user, setUser] = useState(null);
    const [view, setView] = useState('home'); // home, lobby, game, spectator
    const [roomCode, setRoomCode] = useState('');
    const [gameState, setGameState] = useState(null);
    const [error, setError] = useState('');
    const [userName, setUserName] = useState('');
    
    // Auth & Init
    useEffect(() => {
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) {
                console.error("Auth failed", err);
                setError("Could not connect to game servers.");
            }
        };
        initAuth();
        const unsubscribe = onAuthStateChanged(auth, (u) => {
            setUser(u);
            // Check URL for room code to auto-join
            const params = new URLSearchParams(window.location.search);
            const urlRoom = params.get('room');
            if (urlRoom && u) {
                setRoomCode(urlRoom);
                // We don't auto-join here to let them set a name first, but we prefill the code
            }
        });
        return () => unsubscribe();
    }, []);

    // Firestore Listener
    useEffect(() => {
        if (!user || !roomCode) return;
        
        // Listen to public data because this is a shared game room
        const roomRef = doc(db, 'artifacts', appId, 'public', 'data', `sb_room_${roomCode}`);
        
        const unsubscribe = onSnapshot(roomRef, (snapshot) => {
            if (snapshot.exists()) {
                setGameState(snapshot.data());
                // If we are just viewing home, move to lobby if we have data (rejoin scenario)
                if (view === 'home' && snapshot.data().players.some(p => p.uid === user.uid)) {
                   setView('lobby');
                }
            } else {
                if (view !== 'home') {
                    setError("Room closed or does not exist.");
                    setView('home');
                }
            }
        }, (err) => {
            console.error("Snapshot error:", err);
            setError("Connection lost.");
        });

        return () => unsubscribe();
    }, [roomCode, user, view]);

    // --- Actions ---

    const createRoom = async () => {
        if (!userName.trim()) return setError("Please enter a name");
        const code = generateRoomCode();
        setRoomCode(code);
        
        const initialState = {
            code: code,
            hostId: user.uid,
            status: 'lobby', // lobby, writing, voting, finished
            round: 1,
            maxRounds: 5,
            genre: 'Adventure',
            story: ["Once upon a time..."],
            players: [{ uid: user.uid, name: userName, score: 0 }],
            candidates: [], // { uid, text, votes }
            createdAt: Date.now()
        };

        try {
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', `sb_room_${code}`), initialState);
            setView('lobby');
        } catch (e) {
            setError("Failed to create room.");
        }
    };

    const joinRoom = async () => {
        if (!userName.trim()) return setError("Please enter a name");
        if (!roomCode || roomCode.length !== 4) return setError("Invalid room code");
        
        const roomRef = doc(db, 'artifacts', appId, 'public', 'data', `sb_room_${roomCode}`);
        try {
            const snap = await getDoc(roomRef);
            if (!snap.exists()) return setError("Room not found");
            
            const data = snap.data();
            if (data.status !== 'lobby' && !data.players.some(p => p.uid === user.uid)) {
                return setError("Game already in progress.");
            }

            // check if already joined
            if (!data.players.some(p => p.uid === user.uid)) {
                await updateDoc(roomRef, {
                    players: arrayUnion({ uid: user.uid, name: userName, score: 0 })
                });
            }
            setView('lobby');
        } catch (e) {
            setError("Failed to join.");
        }
    };

    const enterSpectator = () => {
        if (!roomCode) return setError("Enter a room code to spectate");
        setView('spectator');
    };

    // --- Render Logic ---

    if (!user) return <div className="h-screen bg-slate-900 text-white flex items-center justify-center">Loading...</div>;

    return (
        <div className="min-h-screen bg-slate-900 text-slate-100 font-sans selection:bg-fuchsia-500 selection:text-white">
            <div className="max-w-4xl mx-auto p-4 md:p-6 min-h-screen flex flex-col">
                
                {/* Header (Hidden in Spectator if active game) */}
                {view !== 'spectator' && (
                    <header className="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
                        <div className="flex items-center gap-2">
                            <BookOpen className="text-fuchsia-500" />
                            <h1 className="font-bold text-xl tracking-tight">Story Builder</h1>
                        </div>
                        {roomCode && (
                            <div className="bg-slate-800 px-3 py-1 rounded-full text-sm font-mono text-fuchsia-400 border border-slate-700">
                                Room: {roomCode}
                            </div>
                        )}
                    </header>
                )}

                {/* Error Banner */}
                {error && (
                    <div className="bg-red-500/20 border border-red-500 text-red-200 p-3 rounded-lg mb-4 text-sm flex justify-between items-center">
                        <span>{error}</span>
                        <button onClick={() => setError('')} className="font-bold">&times;</button>
                    </div>
                )}

                {/* --- VIEWS --- */}

                {view === 'home' && (
                    <HomeView 
                        userName={userName} 
                        setUserName={setUserName} 
                        roomCode={roomCode} 
                        setRoomCode={setRoomCode}
                        createRoom={createRoom}
                        joinRoom={joinRoom}
                        enterSpectator={enterSpectator}
                    />
                )}

                {view === 'lobby' && gameState && (
                    <LobbyView 
                        gameState={gameState} 
                        user={user} 
                        db={db} 
                        appId={appId}
                        setView={setView}
                    />
                )}

                {(view === 'lobby' || view === 'game') && gameState && gameState.status !== 'lobby' && (
                    <GameController 
                        gameState={gameState} 
                        user={user} 
                        db={db} 
                        appId={appId}
                    />
                )}

                {view === 'spectator' && (
                    <SpectatorView 
                        roomCode={roomCode} 
                        gameState={gameState} 
                        db={db}
                        appId={appId}
                    />
                )}

            </div>
        </div>
    );
}

// --- Sub-Components ---

function HomeView({ userName, setUserName, roomCode, setRoomCode, createRoom, joinRoom, enterSpectator }) {
    return (
        <div className="flex-1 flex flex-col justify-center items-center max-w-md mx-auto w-full animate-in fade-in slide-in-from-bottom-4 duration-700">
            <div className="w-full bg-slate-800/50 backdrop-blur border border-slate-700 p-8 rounded-2xl shadow-xl">
                <div className="mb-6">
                    <label className="block text-xs font-bold text-slate-400 uppercase mb-2">Your Name</label>
                    <input 
                        type="text" 
                        value={userName} 
                        onChange={(e) => setUserName(e.target.value)}
                        placeholder="e.g. StoryTeller99"
                        className="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-fuchsia-500 transition-colors"
                    />
                </div>

                <div className="space-y-3">
                    <button 
                        onClick={createRoom}
                        className="w-full bg-gradient-to-r from-fuchsia-600 to-purple-600 hover:from-fuchsia-500 hover:to-purple-500 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-purple-500/20 transition-all transform active:scale-95 flex items-center justify-center gap-2"
                    >
                        <Play size={18} /> Host New Game
                    </button>
                    
                    <div className="relative flex py-2 items-center">
                        <div className="flex-grow border-t border-slate-700"></div>
                        <span className="flex-shrink mx-4 text-slate-500 text-xs">OR JOIN</span>
                        <div className="flex-grow border-t border-slate-700"></div>
                    </div>

                    <div className="flex gap-2">
                        <input 
                            type="text" 
                            value={roomCode} 
                            onChange={(e) => setRoomCode(e.target.value.toUpperCase())}
                            placeholder="CODE"
                            className="w-24 bg-slate-900 border border-slate-700 rounded-lg p-3 text-center text-white font-mono uppercase tracking-widest focus:outline-none focus:border-fuchsia-500"
                            maxLength={4}
                        />
                        <button 
                            onClick={joinRoom}
                            className="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-4 rounded-xl transition-colors"
                        >
                            Join Room
                        </button>
                    </div>
                </div>

                <div className="mt-8 pt-6 border-t border-slate-700 text-center">
                    <button 
                        onClick={enterSpectator}
                        className="text-slate-500 hover:text-fuchsia-400 text-sm flex items-center justify-center gap-2 mx-auto transition-colors"
                    >
                        <Tv size={16} /> Enter Spectator Mode (TV)
                    </button>
                </div>
            </div>
        </div>
    );
}

function LobbyView({ gameState, user, db, appId, setView }) {
    const isHost = gameState.hostId === user.uid;
    const roomRef = doc(db, 'artifacts', appId, 'public', 'data', `sb_room_${gameState.code}`);

    const startGame = async () => {
        await updateDoc(roomRef, { status: 'writing' });
    };

    const changeGenre = async (e) => {
        await updateDoc(roomRef, { genre: e.target.value });
    };

    if (gameState.status !== 'lobby') return null; // Handled by GameController

    // Generate QR Code URL
    const gameUrl = window.location.href.split('?')[0] + `?room=${gameState.code}`;
    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(gameUrl)}&color=d946ef&bgcolor=0f172a`;

    return (
        <div className="flex flex-col md:flex-row gap-8 animate-in fade-in zoom-in-95">
            {/* Left Col: Info */}
            <div className="flex-1 space-y-6">
                <div className="bg-slate-800/50 p-6 rounded-2xl border border-slate-700">
                    <h2 className="text-2xl font-bold mb-4">Lobby</h2>
                    <div className="space-y-4">
                        <div>
                            <label className="text-xs text-slate-400 uppercase font-bold">Genre</label>
                            {isHost ? (
                                <select 
                                    value={gameState.genre} 
                                    onChange={changeGenre}
                                    className="block w-full mt-1 bg-slate-900 border border-slate-700 rounded p-2 text-white"
                                >
                                    <option>Adventure</option>
                                    <option>Horror</option>
                                    <option>Sci-Fi</option>
                                    <option>Romance</option>
                                    <option>Mystery</option>
                                    <option>Comedy</option>
                                </select>
                            ) : (
                                <div className="text-xl font-medium text-fuchsia-400">{gameState.genre}</div>
                            )}
                        </div>
                        
                        <div className="flex items-center gap-4 bg-slate-900 p-4 rounded-lg border border-slate-800">
                            <img src={qrUrl} alt="Join QR" className="w-24 h-24 rounded-lg" />
                            <div>
                                <div className="text-sm text-slate-400 mb-1">Join Code</div>
                                <div className="text-4xl font-mono font-bold tracking-widest text-white">{gameState.code}</div>
                            </div>
                        </div>
                    </div>
                </div>

                {isHost ? (
                    <button 
                        onClick={startGame}
                        className="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-500/20 text-lg transition-all"
                    >
                        Start Game
                    </button>
                ) : (
                    <div className="text-center p-4 text-slate-400 bg-slate-800/30 rounded-xl animate-pulse">
                        Waiting for host to start...
                    </div>
                )}
            </div>

            {/* Right Col: Players */}
            <div className="flex-1 bg-slate-800/30 p-6 rounded-2xl border border-slate-700">
                <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                    <User size={20} className="text-fuchsia-500" /> 
                    Players ({gameState.players.length})
                </h3>
                <div className="grid gap-2">
                    {gameState.players.map(p => (
                        <div key={p.uid} className="bg-slate-800 p-3 rounded-lg flex items-center justify-between">
                            <span className="font-medium">{p.name}</span>
                            {p.uid === gameState.hostId && <span className="text-xs bg-fuchsia-500/20 text-fuchsia-300 px-2 py-1 rounded">HOST</span>}
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
}

function GameController({ gameState, user, db, appId }) {
    // This component switches between Writing, Voting, and Results logic
    const roomRef = doc(db, 'artifacts', appId, 'public', 'data', `sb_room_${gameState.code}`);
    const [submission, setSubmission] = useState('');
    const [hasSubmitted, setHasSubmitted] = useState(false);
    const [selectedVote, setSelectedVote] = useState(null);

    // Reset local state when round changes
    useEffect(() => {
        setSubmission('');
        setHasSubmitted(false);
        setSelectedVote(null);
    }, [gameState.status, gameState.story.length]);

    // Check if user has already submitted/voted based on Firestore data
    useEffect(() => {
        if (gameState.status === 'writing') {
            const alreadySubmitted = gameState.candidates?.some(c => c.uid === user.uid);
            setHasSubmitted(alreadySubmitted);
        }
        if (gameState.status === 'voting') {
            const votes = gameState.currentVotes || {};
            // votes structure: { candidateUid: [voterUid, voterUid] }
            // Actually simpler: let's store votes as an array of { voterUid, candidateUid } in Firestore
            // But for simplicity in this proto, let's assume we check if we clicked.
        }
    }, [gameState, user.uid]);

    // --- Handlers ---

    const submitSentence = async () => {
        if (!submission.trim()) return;
        setHasSubmitted(true); // Optimistic update
        
        // Add candidate
        const newCandidate = { uid: user.uid, text: submission, votes: [] };
        
        // We need to atomically add to candidates. 
        // If all players submitted, switch to voting.
        // This logic is complex for client-side only without Cloud Functions, 
        // so we will have the HOST trigger the phase change or check logic here.
        
        await updateDoc(roomRef, {
            candidates: arrayUnion(newCandidate)
        });
    };

    const castVote = async (candidateUid) => {
        setSelectedVote(candidateUid);
        // We'll increment a counter on that candidate in the array? 
        // Firestore array updates are hard for specific objects.
        // Easier: Remove the whole candidates array and write it back with the vote added? Race conditions!
        // Better Pattern for No-Cloud-Functions: Use a separate 'votes' map field: `votes.${candidateUid}`: increment(1)
        // But we want to track WHO voted to prevent double voting.
        // Let's use a subcollection 'round_votes' or just a 'votes' array { voter: uid, candidate: uid }
        
        await updateDoc(roomRef, {
            votes: arrayUnion({ voter: user.uid, candidate: candidateUid })
        });
    };

    // HOST ONLY: Check progression
    useEffect(() => {
        if (gameState.hostId !== user.uid) return;

        const checkProgress = async () => {
            if (gameState.status === 'writing') {
                // If all players have candidates
                if (gameState.candidates && gameState.candidates.length >= gameState.players.length) {
                    // Move to voting
                    await updateDoc(roomRef, { status: 'voting', votes: [] });
                }
            } else if (gameState.status === 'voting') {
                // If all players voted
                if (gameState.votes && gameState.votes.length >= gameState.players.length) {
                    // Calculate winner
                    const counts = {};
                    gameState.votes.forEach(v => {
                        counts[v.candidate] = (counts[v.candidate] || 0) + 1;
                    });
                    
                    let winnerUid = null;
                    let maxVotes = -1;
                    
                    // Simple winner determination
                    Object.keys(counts).forEach(uid => {
                        if (counts[uid] > maxVotes) {
                            maxVotes = counts[uid];
                            winnerUid = uid;
                        }
                    });

                    // If tie or no votes, pick random
                    if (!winnerUid && gameState.candidates.length > 0) {
                        winnerUid = gameState.candidates[0].uid;
                    }

                    const winningCandidate = gameState.candidates.find(c => c.uid === winnerUid);
                    
                    // Update Story
                    if (winningCandidate) {
                         await updateDoc(roomRef, {
                            story: arrayUnion(winningCandidate.text),
                            status: gameState.story.length + 1 >= gameState.maxRounds ? 'finished' : 'writing',
                            candidates: [],
                            votes: []
                        });
                    }
                }
            }
        };

        const timer = setTimeout(checkProgress, 1000); // Debounce checks
        return () => clearTimeout(timer);
    }, [gameState, user.uid]);


    // --- Render Views ---

    if (gameState.status === 'finished') {
        return (
            <div className="max-w-2xl mx-auto space-y-6 animate-in zoom-in-95">
                <div className="text-center mb-8">
                    <h2 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-purple-600 mb-2">The End</h2>
                    <p className="text-slate-400">Here is your masterpiece.</p>
                </div>
                <div className="bg-white text-slate-900 p-8 rounded-lg shadow-2xl font-serif text-lg leading-relaxed relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-fuchsia-500 to-purple-600"></div>
                    {gameState.story.join(" ")}
                </div>
                <button onClick={() => updateDoc(roomRef, { status: 'lobby', story: ["New story..."], candidates: [] })} className="w-full bg-slate-700 py-3 rounded-lg font-bold">Back to Lobby</button>
            </div>
        );
    }

    return (
        <div className="max-w-lg mx-auto flex flex-col h-full">
            {/* Story Context (Last 2 sentences) */}
            <div className="bg-slate-800/50 p-4 rounded-xl border border-slate-700 mb-6 shadow-inner">
                <div className="text-xs text-slate-500 uppercase font-bold mb-2">Previous Story</div>
                <p className="text-slate-300 italic">
                    "...{gameState.story.slice(-2).join(" ")}"
                </p>
            </div>

            {gameState.status === 'writing' && (
                <div className="animate-in slide-in-from-right-4">
                    <h2 className="text-xl font-bold mb-4 text-fuchsia-400">Write the next sentence</h2>
                    {hasSubmitted ? (
                        <div className="text-center p-8 bg-slate-800 rounded-xl border border-slate-700">
                            <Clock className="w-12 h-12 text-fuchsia-500 mx-auto mb-4 animate-spin-slow" />
                            <p className="font-bold text-lg">Waiting for others...</p>
                            <p className="text-sm text-slate-400 mt-2">{gameState.candidates?.length} / {gameState.players.length} submitted</p>
                        </div>
                    ) : (
                        <div>
                            <textarea 
                                value={submission}
                                onChange={(e) => setSubmission(e.target.value)}
                                className="w-full bg-slate-800 border border-slate-600 rounded-xl p-4 text-white focus:border-fuchsia-500 focus:outline-none h-32 mb-4"
                                placeholder="And then suddenly..."
                                maxLength={140}
                            />
                            <button 
                                onClick={submitSentence}
                                className="w-full bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-bold py-3 rounded-xl transition-all"
                            >
                                Submit Sentence
                            </button>
                        </div>
                    )}
                </div>
            )}

            {gameState.status === 'voting' && (
                <div className="animate-in slide-in-from-right-4">
                    <h2 className="text-xl font-bold mb-4 text-purple-400">Vote for the best continuation</h2>
                    <div className="space-y-3">
                        {gameState.candidates.map((c, i) => {
                            const isSelected = selectedVote === c.uid;
                            // Check if current user has already voted in DB
                            const alreadyVoted = gameState.votes?.some(v => v.voter === user.uid);
                            
                            return (
                                <button
                                    key={i}
                                    disabled={alreadyVoted}
                                    onClick={() => castVote(c.uid)}
                                    className={`w-full text-left p-4 rounded-xl border transition-all ${
                                        isSelected 
                                            ? 'bg-purple-600 border-purple-400 text-white shadow-lg shadow-purple-500/20' 
                                            : 'bg-slate-800 border-slate-700 hover:border-slate-500'
                                    } ${alreadyVoted && !isSelected ? 'opacity-50' : ''}`}
                                >
                                    "{c.text}"
                                </button>
                            );
                        })}
                    </div>
                    <div className="mt-4 text-center text-sm text-slate-500">
                         {gameState.votes?.length || 0} / {gameState.players.length} votes cast
                    </div>
                </div>
            )}
        </div>
    );
}

function SpectatorView({ roomCode, gameState, db, appId }) {
    // If we haven't loaded game state yet
    if (!gameState && roomCode) {
        // The main App component handles the loading, so if we are here and gameState is null, it's loading or error
        return <div className="p-10 text-center">Connecting to Big Screen...</div>;
    }

    if (!gameState) return <div className="p-10 text-center text-red-400">Waiting for data...</div>;

    return (
        <div className="fixed inset-0 bg-slate-900 flex flex-col items-center justify-center p-8 overflow-hidden">
            {/* Background Animation */}
            <div className="absolute inset-0 overflow-hidden pointer-events-none">
                <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-fuchsia-600/20 rounded-full blur-3xl animate-pulse"></div>
                <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-600/20 rounded-full blur-3xl animate-pulse delay-1000"></div>
            </div>

            <div className="relative z-10 w-full max-w-5xl h-full flex flex-col">
                <div className="flex justify-between items-center mb-12 border-b border-slate-700 pb-6">
                    <div>
                        <h1 className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-fuchsia-400 to-purple-400">
                            {gameState.genre} Story
                        </h1>
                        <div className="text-xl text-slate-400 mt-2">Join at <span className="text-white font-bold">bigmini.games</span> Code: <span className="text-fuchsia-400 font-mono font-bold text-2xl px-2 border border-fuchsia-500/50 rounded">{gameState.code}</span></div>
                    </div>
                    {gameState.status === 'lobby' && (
                         <img src={`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(window.location.href.split('?')[0] + `?room=${gameState.code}`)}&color=d946ef&bgcolor=0f172a`} className="rounded-xl shadow-lg border-2 border-slate-700" alt="Join QR" />
                    )}
                </div>

                <div className="flex-grow flex items-center justify-center">
                    {gameState.status === 'lobby' && (
                        <div className="text-center">
                            <h2 className="text-3xl font-bold mb-8">Waiting for Players...</h2>
                            <div className="grid grid-cols-4 gap-4">
                                {gameState.players.map(p => (
                                    <div key={p.uid} className="bg-slate-800 px-6 py-4 rounded-full text-xl font-bold border border-slate-700 animate-bounce-short">
                                        {p.name}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {(gameState.status === 'writing' || gameState.status === 'voting' || gameState.status === 'finished') && (
                        <div className="w-full h-full flex flex-col gap-8">
                            {/* The Story So Far */}
                            <div className="flex-1 overflow-y-auto bg-slate-800/30 p-8 rounded-3xl border border-slate-700/50 shadow-2xl backdrop-blur-sm">
                                <p className="text-2xl md:text-3xl leading-relaxed font-serif text-slate-200">
                                    {gameState.story.map((s, i) => (
                                        <span key={i} className={i === gameState.story.length - 1 ? "text-white font-bold bg-fuchsia-500/20 px-1 rounded animate-pulse" : "opacity-80"}>
                                            {s}{" "}
                                        </span>
                                    ))}
                                </p>
                            </div>

                            {/* Status Bar */}
                            <div className="h-32 bg-slate-900/80 border-t border-slate-700 flex items-center justify-center">
                                {gameState.status === 'writing' && (
                                    <div className="text-3xl font-bold text-fuchsia-400 animate-pulse">
                                        Writers are writing... ({gameState.candidates?.length || 0}/{gameState.players.length})
                                    </div>
                                )}
                                {gameState.status === 'voting' && (
                                    <div className="text-3xl font-bold text-purple-400 animate-pulse">
                                        Voting in progress... ({gameState.votes?.length || 0}/{gameState.players.length})
                                    </div>
                                )}
                                {gameState.status === 'finished' && (
                                    <div className="text-3xl font-black text-green-400">
                                        STORY COMPLETE
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}

export default App;
